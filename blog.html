<!DOCTYPE html>
<html lang="en" translate="yes">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <meta name="google-translate-customization" content="enabled">
    <title>GR Yachts Dubai - Luxury Yacht Rentals</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="assets/css/style.css?v=5" rel="stylesheet">
    <link href="assets/css/blog.css?v=5" rel="stylesheet">
    <link href="assets/css/translation-widget.css" rel="stylesheet">


    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Translate Script -->
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,ar,ru,fr,es,zh-CN,hi,ur,de,it,pt,ja,ko,th,tr,nl,pl,sv,da,no,fi,he,fa',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false,
                multilanguagePage: true
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</head>

<body>
    <!-- Navigation -->
  <div id="header"></div>

    <!-- Hero Section -->
    <section class="hero" id="blogHeroSection">
        <div class="container h-100">
            <div class="row h-100 align-items-center" style="margin-top: -40px;">
                <div class="col-12 text-center text-white">
                    <h1 class="hero-title" id="heroTitle">Read Blog for know about Us</h1>
                    <p class="hero-subtitle mb-4" id="heroSubtitle" style="font-size: 1.2rem; display: none;">Discover insights, tips, and stories about luxury yacht experiences</p>
                    <button class="btn btn-primary mt-3" id="heroButton">BOOK A YACHT</button>
                </div>
            </div>
        </div>
    </section>

   <!-- Blog Listing Section -->
   <section class="blog-listing py-5">
       <div class="container">
           <!-- Loading State -->
           <div id="blogsLoading" class="text-center py-5">
               <div class="spinner-border text-primary mb-3" role="status">
                   <span class="visually-hidden">Loading...</span>
               </div>
               <p class="text-muted">Loading blog posts...</p>
           </div>
           
           <!-- Blog Posts Container -->
           <div class="row g-4" id="blogPostsContainer" style="display: none;">
               <!-- Dynamic blog posts will be loaded here -->
           </div>
           
           <!-- No Blogs Message -->
           <div id="noBlogsMessage" class="text-center py-5" style="display: none;">
               <i class="fas fa-blog text-muted mb-3" style="font-size: 3rem;"></i>
               <h4 class="text-muted">No Blog Posts Found</h4>
               <p class="text-muted">Check back later for new content!</p>
           </div>

           <!-- Pagination -->
           <div id="blogPagination" class="text-center mt-5" style="display: none;">
               <!-- Dynamic pagination will be loaded here -->
           </div>
       </div>
   </section>
   
    <!-- Footer -->
     <div id="footer"></div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="assets/js/main.js"></script>
    <!-- Blog Loading Script -->
    <script>
        let currentPage = 1;
        
        // Load blog posts from API
        async function loadBlogPosts(page = 1) {
            try {
                currentPage = page;
                showLoading();
                
                const response = await fetch(`api/v1/publicBlogHandler.php?action=list&page=${page}&limit=6`);
                const data = await response.json();
                
                if (data.success && data.data && data.data.length > 0) {
                    displayBlogPosts(data.data);
                    displayPagination(data.pagination);
                } else {
                    showNoBlogsMessage();
                }
            } catch (error) {
                console.error('Error loading blog posts:', error);
                showNoBlogsMessage();
            }
        }
        
        function showLoading() {
            document.getElementById('blogsLoading').style.display = 'block';
            document.getElementById('blogPostsContainer').style.display = 'none';
            document.getElementById('noBlogsMessage').style.display = 'none';
            document.getElementById('blogPagination').style.display = 'none';
        }
        
        function showNoBlogsMessage() {
            document.getElementById('blogsLoading').style.display = 'none';
            document.getElementById('blogPostsContainer').style.display = 'none';
            document.getElementById('noBlogsMessage').style.display = 'block';
            document.getElementById('blogPagination').style.display = 'none';
        }
        
        function displayBlogPosts(blogs) {
            const container = document.getElementById('blogPostsContainer');
            
            container.innerHTML = blogs.map(blog => `
                <div class="col-lg-4 col-md-6">
                    <div class="blog-card">
                        <div class="blog-image">
                            <img src="${blog.featured_image ? `api/uploads/blog/${blog.featured_image}` : 'assets/images/yatch1.png'}" 
                                 alt="${blog.title}" 
                                 class="img-fluid"
                                 onerror="this.src='assets/images/yatch1.png'">
                        </div>
                        <div class="blog-content">
                            <div class="blog-date">${blog.formatted_date}</div>
                            <h4 class="blog-title">${truncateText(blog.title, 80)}</h4>
                            <p class="blog-description">${truncateText(blog.excerpt || stripHtml(blog.content), 120)}</p>
                            <a href="blog-detail.php?slug=${blog.slug}" class="read-more">Read More <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('blogsLoading').style.display = 'none';
            document.getElementById('blogPostsContainer').style.display = 'flex';
        }
        
        function displayPagination(pagination) {
            if (!pagination || pagination.total_pages <= 1) {
                document.getElementById('blogPagination').style.display = 'none';
                return;
            }
            
            const paginationContainer = document.getElementById('blogPagination');
            let paginationHTML = '<nav><ul class="pagination justify-content-center">';
            
            // Previous button
            if (pagination.has_prev) {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="loadBlogPosts(${pagination.current_page - 1}); return false;">
                            <i class="fas fa-chevron-left"></i> Previous
                        </a>
                    </li>
                `;
            }
            
            // Page numbers
            const startPage = Math.max(1, pagination.current_page - 2);
            const endPage = Math.min(pagination.total_pages, pagination.current_page + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <li class="page-item ${i === pagination.current_page ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="loadBlogPosts(${i}); return false;">${i}</a>
                    </li>
                `;
            }
            
            // Next button
            if (pagination.has_next) {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="loadBlogPosts(${pagination.current_page + 1}); return false;">
                            Next <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                `;
            }
            
            paginationHTML += '</ul></nav>';
            paginationContainer.innerHTML = paginationHTML;
            paginationContainer.style.display = 'block';
        }
        
        // Utility functions
        function truncateText(text, maxLength) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength).trim() + '...';
        }
        
        function stripHtml(html) {
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }
        
        // Load components and blog posts when page loads
        async function loadComponent(id, file) {
            const response = await fetch(file);
            const html = await response.text();
            document.getElementById(id).innerHTML = html;
        }
        
        // Load hero content from API
        async function loadHeroContent() {
            try {
                const response = await fetch('api/v1/publicBlogHandler.php?action=getHeroContent');
                const data = await response.json();
                
                if (data.success && data.data) {
                    const hero = data.data;
                    
                    // Update hero title
                    if (hero.title) {
                        document.getElementById('heroTitle').textContent = hero.title;
                    }
                    
                    // Update hero subtitle
                    const subtitleElement = document.getElementById('heroSubtitle');
                    if (hero.subtitle) {
                        subtitleElement.textContent = hero.subtitle;
                        subtitleElement.style.display = 'block';
                    } else {
                        subtitleElement.style.display = 'none';
                    }
                    
                    // Update hero button
                    const buttonElement = document.getElementById('heroButton');
                    if (hero.button_text) {
                        buttonElement.textContent = hero.button_text;
                    }
                    
                    // Update button link
                    if (hero.button_link) {
                        buttonElement.onclick = function() {
                            if (hero.button_link.startsWith('#')) {
                                // Scroll to section
                                const targetSection = document.querySelector(hero.button_link);
                                if (targetSection) {
                                    targetSection.scrollIntoView({ behavior: 'smooth' });
                                }
                            } else {
                                // Navigate to page
                                window.location.href = hero.button_link;
                            }
                        };
                    }
                    
                    // Update hero background image
                    const heroSection = document.getElementById('blogHeroSection');
                    if (hero.image_path) {
                        const imageUrl = `api/uploads/blog/${hero.image_path}`;
                        
                        // Test if image exists before applying
                        const testImage = new Image();
                        testImage.onload = function() {
                            heroSection.style.backgroundImage = `url('${imageUrl}')`;
                            heroSection.style.backgroundSize = 'cover';
                            heroSection.style.backgroundPosition = 'center center';
                            heroSection.style.backgroundRepeat = 'no-repeat';
                            console.log('Hero background updated to:', imageUrl);
                        };
                        testImage.onerror = function() {
                            console.warn('Failed to load hero image:', imageUrl);
                            // Keep default background from CSS
                        };
                        testImage.src = imageUrl;
                    }
                }
            } catch (error) {
                console.error('Error loading hero content:', error);
                // Keep default hero content
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadComponent("header", "_partials/header.html");
            loadComponent("footer", "_partials/footer.html");
            loadHeroContent(); // Load hero content
            loadBlogPosts(1); // Load first page of blog posts
        });
    </script>
</body>
</html>